#!/usr/bin/env bash

# Function to query DNS and display information
runDig() {
    subdomain="$1"
    domain="$2"

    result=$(dig +short "$subdomain.$domain")
    if [ -z "$result" ]; then
        echo "The subdomain $subdomain does not exist for $domain."
    else
        record_type=$(dig +short "$subdomain.$domain" | awk '{print $2}')
        echo "The subdomain $subdomain is a $record_type record and points to $result"
    fi
}

# Check if the configuration file exists
config_file="subdomains.cfg"
if [ ! -f "$config_file" ]; then
    echo "Configuration file '$config_file' not found. Please create it."
    exit 1
fi

# Read subdomain configurations from the configuration file
declare -A subdomains
while read -r subdomain ip; do
    subdomains["$subdomain"]=$ip
done < "$config_file"

# Check the number of arguments provided
if [ $# -eq 1 ]; then
    domain="$1"
    for subdomain in "${!subdomains[@]}"; do
        runDig "$subdomain" "$domain"
    done
elif [ $# -eq 2 ]; then
    domain="$1"
    subdomain="$2"
    if [ -n "${subdomains[$subdomain]}" ]; then
        runDig "$subdomain" "$domain"
    else
        echo "The subdomain $subdomain is not configured for $domain."
    fi
else
    echo "Usage: $0 <domain> [subdomain]"
    exit 1
fi
